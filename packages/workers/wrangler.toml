# ArgusGuard API - Cloudflare Workers Configuration
# Documentation: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "argusguard-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Workers Paid Plan - 50ms CPU limit for AI analysis
[limits]
cpu_ms = 50

# ===========================================
# SETUP INSTRUCTIONS
# ===========================================
# 1. Create KV namespace:
#    wrangler kv:namespace create SCAN_CACHE
#    wrangler kv:namespace create SCAN_CACHE --preview
#
# 2. Update the KV namespace IDs below with the returned values
#
# 3. Set secrets (do NOT commit these):
#    wrangler secret put TOGETHER_AI_API_KEY
#    wrangler secret put SUPABASE_URL
#    wrangler secret put SUPABASE_ANON_KEY
#    wrangler secret put TWITTER_API_KEY
#    wrangler secret put TWITTER_API_SECRET
#    wrangler secret put TWITTER_ACCESS_TOKEN
#    wrangler secret put TWITTER_ACCESS_TOKEN_SECRET
#    wrangler secret put TELEGRAM_BOT_TOKEN
#    wrangler secret put TELEGRAM_CHANNEL_ID
#    wrangler secret put ADMIN_SECRET          # For training data API access
#
# 3b. RPC Providers (optional - uses free public RPC by default)
#    Multi-RPC with automatic failover. Set any/all of these:
#    wrangler secret put QUICKNODE_RPC_URL     # Free: 10M req/month
#    wrangler secret put ALCHEMY_RPC_URL       # Free: 300M CU/month
#    wrangler secret put TRITON_RPC_URL        # Community RPC (unlimited)
#    wrangler secret put HELIUS_API_KEY        # Paid (used as fallback)
#    wrangler secret put SOLANA_RPC_URL        # Custom RPC endpoint
#
# 4. For local development, create .dev.vars file:
#    cp .dev.vars.example .dev.vars
#    Then fill in your API keys
#
# 5. Deploy:
#    pnpm deploy (or wrangler deploy)
# ===========================================

[vars]
ENVIRONMENT = "production"

# KV Namespace for caching honeypot scan results
# Run: wrangler kv:namespace create SCAN_CACHE
# Then replace the IDs below
[[kv_namespaces]]
binding = "SCAN_CACHE"
id = "f68ebeb06b094a29a537c65738f6c50e"
preview_id = "3fd64db66b4f49f3b56d77f64d8138b3"

# D1 Database for Bundle Network Map
# Run: wrangler d1 create argus-bundle-network
# Then replace the database_id below
# After creation, initialize schema:
#   wrangler d1 execute argus-bundle-network --file=./src/db/bundle-network.sql
[[d1_databases]]
binding = "BUNDLE_DB"
database_name = "argus-bundle-network"
database_id = "9cd48296-20f5-4e15-bb81-5b86877bc117"

# Cron Triggers for background jobs
# Runs every 6 hours to check if tracked tokens have rugged
[triggers]
crons = ["0 */6 * * *"]

# Development environment
[env.dev]
name = "argusguard-api-dev"

[env.dev.vars]
ENVIRONMENT = "development"

# Staging environment (optional)
[env.staging]
name = "argusguard-api-staging"

[env.staging.vars]
ENVIRONMENT = "staging"
